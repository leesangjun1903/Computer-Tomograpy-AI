#


# Using Diffusion Model
## CBCT-Based synthetic CT image generation using conditional denoising diffusion probabilistic model
https://github.com/junbopeng/conditional_DDPM?tab=readme-ov-file

배경: 이미지 유도 방사선 치료(IGRT) 과정에서 정확한 환자 위치를 파악하기 위해 매일 또는 매주 콘빔 컴퓨터 단층 촬영(CBCT) 스캔이 일반적으로 사용되므로 적응형 방사선 치료(ART) 재계획에 이상적인 옵션입니다.  
그러나 심각한 인공물과 부정확한 하운스필드 단위(HU) 값이 존재하기 때문에 장기 분할 및 용량 계산과 같은 정량적 응용 분야에 사용할 수 없습니다.  
온라인 ART의 임상을 활성화하려면 CT 스캔과 비슷한 품질의 CBCT 스캔 이미지를 받는 것이 중요합니다.  
목적: 이 연구는 CBCT의 화질 개선을 위해 CBCT에서 CT 분포로 이미지 변환을 수행하는 조건부 확산 모델을 개발하는 것을 목표로 합니다.  
방법: 제안된 방법은 조건부 노이즈 제거 확산 확률 모델(DDPM)로, 잔차 및 주의 블록이 있는 시간 내장 U-net 아키텍처를 활용하여 백색 가우시안 노이즈 샘플을 CBCT에 조건을 맞춘 목표 CT 분포로 점진적으로 변환합니다.  
이 모델은 변형된 계획 CT(dpCT)와 CBCT 이미지 쌍에 대해 학습되었으며, 뇌 환자 연구와 두경부(H&N) 환자 연구에서 그 타당성이 검증되었습니다.  
제안된 알고리즘의 성능은 생성된 합성 CT(sCT) 샘플에 대한 평균 절대 오차(MAE), 피크 신호 대 잡음비(PSNR) 및 정규화된 교차 상관관계(NCC) 메트릭을 사용하여 평가되었습니다.  
제안된 방법은 다른 네 가지 확산 모델 기반(sCT) 생성 방법과도 비교되었습니다.  
결과: 뇌 환자 연구에서 생성된 sCT의 MAE, PSNR, NCC는 각각 25.99HU, 30.49dB, 0.99로 CBCT 이미지의 40.63HU, 27.87dB, 0.98에 비해 높았습니다.  
H&N 환자 연구에서 지표는 각각 32.56HU, 27.65dB, 0.98 및 38.99HU, 27.00, 0.98, sCT 및 CBCT였습니다.  
다른 4개의 확산 모델과 1주기 생성 적대적 네트워크(Cycle GAN)와 비교했을 때, 제안된 방법은 시각적 품질과 정량적 분석 모두에서 우수한 결과를 보였습니다.  
결론: 제안된 조건부 DDPM 방법은 정확한 HU 수와 감소된 아티팩트로 CBCT에서 sCT를 생성하여 온라인 ART에 대한 정확한 CBCT 기반 장기 분할 및 용량 계산을 가능하게 합니다.  

### Introduction
콘빔 컴퓨터 단층 촬영(CBCT) 스캔은 환자 설정 및 치료 모니터링을 위한 현재 이미지 유도 방사선 치료(IGRT) 관행에서 매일 또는 매주 널리 사용되며, 위치 오류를 줄이고 방사선 치료의 정확도를 향상시킵니다.1  
기존 진단 CT 이미지에 비해 CBCT 이미지는 줄무늬, 음영, 부스러기, 산란 오염과 같은 상당한 아티팩트로 인해 하운스필드 단위(HU) 값의 심각한 부정확성을 초래하는 경우가 많습니다.2-4  
이러한 요인은 정량적 응용을 위해 CBCT 이미지를 사용하지 못하도록 하여 CBCT 기반 적응형 방사선 치료(ART)의 구현을 방해합니다.  
이 문제를 해결하기 위해 현재 ART 관행은 선량 계산을 위해 CBCT의 해부학적 구조와 일치하도록 변형된 계획 팬빔 CT(pCT) 이미지를 사용합니다.5  
그러나 이미지 등록의 품질은 해부학적 구조 및 아티팩트손 CBCT 이미지의 변경으로 인해 작업자의 경험과 직관에 따라 달라지는 경우가 많으며, ART 구현의 정확도를 제한합니다.6.  

현재 직접 CBCT 기반 ART를 활성화하기 위한 시도에는 두 가지 주요 접근 방식이 있습니다:  
하나는 CBCT의 화질을 개선하기 위해 아티팩트 보정을 수행하는 것이고, 다른 하나는 CBCT 이미지에서 pCT와 유사한 수준의 화질을 가진 합성 CT(sCT) 이미지를 생성하는 것입니다.6,18-22  
CBCT 아티팩트를 줄이기 위한 많은 접근 방식이 있으며, 이는 하드웨어 기반 보정, 모델 기반 및 딥 러닝 기반 보정 방법으로 크게 분류할 수 있습니다.  
하드웨어 수정에는 산란 방지 그리드, 7차 변조 빔 필터,8 및 격자 모양 빔 스톱퍼가 포함됩니다.9  
이러한 하드웨어 수정은 CBCT 이미징에서 산란 아티팩트를 보정하는 데 있어 가능성을 보여주지만, 시스템의 양자 효율성을 본질적으로 낮추고 재구성된 이미지의 신호 대 잡음비를 저하시킬 수도 있습니다.20  
모델 기반 접근 방식은 CBCT 이미징 프로세스를 모델링하여 아티팩트를 보정하려고 시도합니다.  
예를 들어, 몬테카를로(MC)10 및 분석 14 알고리즘은 CBCT 이미징에서 산란 신호를 시뮬레이션하기 위해 개발되었습니다.  
MC 방법은 산란 추정에 정확하지만 계산 집약적인 반면, 분석 산란 커널 알고리즘은 비선형 산란 과정으로 인해 이기종 내부 구조에는 더 빠르지 않습니다.23  
딥 러닝 기반 방법은 투영 및 이미지 영역 모두에서 수행할 수 있는 아티팩트가 있거나 없는 데이터를 사용하여 신경망을 훈련하여 CBCT에서 아티팩트 없는 CBCT로의 매핑을 얻습니다.15-17  
산란,16,17 줄무늬 또는 금속 아티팩트를 완화하는 것이 효과적인 것으로 입증되었지만, 24 학습 기반 접근 방식은 특정 아티팩트 소스를 억제하는 능력이 제한적이며 다른 유형의 아티팩트를 수정할 수 없으며, 이는 모든 아티팩트 감소 방법에서 공통적으로 발생하는 문제입니다.  

sCT 생성 방법은 pCT의 사전 정보를 사용하여 딥 러닝을 통해 소스 CBCT 분포에서 타겟 pCT 분포로 복셀을 매핑하는 모델을 훈련합니다.6,18-22  
가장 간단한 방법은 일치하는 CBCT 변형 pCT(dpCT) 데이터 쌍을 사용하여 지도 학습을 통해 U-net과 같은 신경망을 훈련하는 것입니다.18  
그러나 pCT와 CBCT 이미지 간의 해부학적 변화로 인한 잔여 불일치 오류가 항상 존재하며, 이는 지도 이미지 간 변환에 부정적인 영향을 미칠 수 있습니다.  
이 문제를 극복하기 위해 주로 두 가지 범주의 방법이 제안되었습니다.  
첫 번째 접근 방식은 페어링되지 않은 CBCT-pCT 데이터로 비지도 학습을 수행하는 것입니다.19,21  
예를 들어, Cycle GAN25는 소스 이미지와 변형된 이미지에서 복구된 이미지 간의 주기적 일관성을 강화하여 CBCT에서 CT로 변환되는 동안 해부학적 보존의 정확도를 향상시킬 수 있습니다.21  
두 번째 접근 방식은 전용 모듈과 추가 손실 함수를 도입하여 입력 CBCT의 구조를 보존하고 지도 학습 프레임워크의 구조적 변화를 학습하는 것입니다.  
고유 순환 손실의 특징 보존 특성과 도입 전략을 결합한 Cycle-GAN,2022에 기울기 차이 손실 및 주의 메커니즘이 도입되어 췌장 ART와 같은 어려운 시나리오에서 sCT 생성에서 우수함을 보여주었습니다.  

확산 모델은 이미지 합성, 26 이미지 인페인팅, 27 및 이미지 초해상도와 같은 작업에서 GAN을 능가하는 것으로 나타난 새로운 생성 접근 방식입니다.28,29  
의료 영상 분야에서 많은 관심을 받고 있습니다.  
의료 영상 분야에서 확산 모델의 첫 번째 응용 중 하나는 희소 시점 CT 재구성 및 금속 아티팩트 제거와 같은 역 문제를 해결하는 것이었습니다.30  
가장 유명한 확산 모델 중 하나인 노이즈 제거 확산 확률 모델(DDPM)은 샘플링되지 않은 MRI 재구성, 32,33개의 MRI와 CT 이미지 간 변환, 34개의 저선량 CT 노이즈 제거, 35개의 저선량 CT 및 4D CT 생성에 사용되었습니다.36  
해석 및 훈련이 어려운 GAN 및 변형 자동 인코더(VAE) 모델과 비교할 때 확산 모델은 분석적으로 원칙적이고 훈련하기 쉬우며 최첨단(SoAT) 화질을 생성합니다.37,38

이 연구에서 우리는 CBCT 이미지에서 sCT를 생성하기 위한 조건부 DDPM 프레임워크를 제안했습니다.  
쌍을 이룬 CBCT-dpCT 데이터는 dpCT가 목표 데이터 분포로, CBCT가 조건으로 사용되는 모델 학습에 사용되었습니다.  
그런 다음 훈련된 모델은 CBCT 대응 모델에 따라 흰색 가우시안 노이즈 샘플을 점진적으로 목표 sCT로 변환할 수 있습니다.  
뇌와 두경부(H&N) 환자를 대상으로 한 실험 결과, 제안된 조건부 DDPM은 정확한 HU 값과 감소된 아티팩트로 sCT를 생성할 수 있으며, 이를 통해 CBCT 기반 ART를 직접 구현할 수 있음을 보여주었습니다.

## Diffusion models in medical imaging: A comprehensive survey
https://github.com/amirhossein-kz/Awesome-Diffusion-Models-in-Medical-Imaging
생성 모델의 일종인 노이즈 제거 확산 모델은 최근 다양한 딥 러닝 문제에서 큰 관심을 받고 있습니다.  
확산 확률론적 모델은 가우시안 노이즈를 추가하여 입력 데이터를 여러 단계에 걸쳐 점진적으로 교란한 다음 확산 과정을 반전시켜 노이즈가 많은 데이터 샘플에서 원하는 노이즈 없는 데이터를 검색하는 순방향 확산 단계를 정의합니다.  
확산 모델은 알려진 계산 부담에도 불구하고 생성된 샘플의 강력한 모드 커버리지와 품질로 널리 인정받고 있습니다.  
컴퓨터 비전의 발전을 활용하여 의료 영상 분야에서도 확산 모델에 대한 관심이 증가하고 있습니다.  
이 설문조사는 연구자가 이러한 확산을 탐색하는 데 도움이 되는 것을 목표로 의료 영상 분야에서 확산 모델에 대한 포괄적인 개요를 제공하고자 합니다.  
구체적으로, 확산 모델의 견고한 이론적 토대와 기본 개념, 즉 확산 확률 모델, 노이즈 조건부 점수 네트워크, 확률 미분 방정식에 대한 세 가지 일반적인 확산 모델링 프레임워크에 대한 소개로 시작합니다.  
그런 다음 의료 영역에서 확산 모델의 체계적인 분류를 제공하고 그 응용, 이미징 양식, 관심 기관 및 알고리즘을 기반으로 하는 다관점 분류를 제안합니다.  
이를 위해 이미지 간 변환, 재구성, 분류, 분할, 노이즈 제거, 2/3D 생성, 이상 감지 및 기타 의학적으로 관련된 문제를 포함하여 의료 영역에서 확산 모델의 광범위한 응용 분야를 다룹니다.  
또한 일부 선택된 접근 방식의 실용적인 사용 사례를 강조한 다음 의료 영역에서 확산 모델의 한계에 대해 논의하고 이 분야의 요구를 충족하기 위한 몇 가지 방향을 제안합니다.  
마지막으로, 우리는 GitHub.1에서 사용 가능한 오픈 소스 구현을 통해 개요 연구를 수집하고 그 안에서 관련 최신 논문을 정기적으로 업데이트하는 것을 목표로 합니다.

### Introduction
신경망을 사용한 생성 모델링은 지난 10년간의 딥 러닝에서 주도적인 역할을 해왔습니다.  
생성 모델은 등장 이후 이미지(Bao et al., 2017; Razavi et al., 2019), 오디오(Kong et al., 2021; 반 덴 오르드 et al., 2016), 텍스트(Li et al., 2022a), 포인트 클라우드(Yang et al., 2019)에 이르기까지 다양한 영역에서 엄청난 영향을 미쳤습니다.  
확률론적 모델링 관점에서 생성 모델의 주요 정의 특징은 샘플 𝒙̃ ~ 𝑝𝜃(𝒙̃)이 훈련 데이터 분포인 𝒙 ~ 𝑝𝑑(𝒙)와 동일한 분포에서 나오도록 훈련한다는 것입니다.  
에너지 기반 모델(EBM)은 상태 공간에 대한 정규화되지 않은 확률 밀도를 정의함으로써 이를 달성하지만, 이러한 방법은 훈련과 추론 모두에서 마르코프 체인 몬테카를로(MCMC) 샘플링이 필요하며, 이는 느린 반복 과정입니다(Bond-Taylor et al., 2021).  
지난 몇 년 동안 일반적인 딥 러닝 아키텍처의 발전으로 인해 생성 모델에 대한 관심이 다시 높아지면서 향상된 시각적 충실도와 샘플링 속도가 드러났습니다.  
구체적으로 생성 적대적 네트워크(GAN)(Goodfellow et al., 2020), 변형 자동 인코더(VAEs)(Rezende et al., 2014), 정규화 흐름(Dinh et al., 2017)이 등장했습니다.  

이 외에도 확산 프로세스에 기반한 생성 모델은 사후 분포의 정렬, 다루기 어려운 분할 함수의 추정, 추가 판별 네트워크의 도입 또는 네트워크 제약 조건의 배치가 각각 필요 없는 기존 VAE, EBM, GAN 및 정규화 흐름에 대한 대안을 제공합니다.   
 
현재까지 확산 모델은 이미지 생성(다리왈 및 니콜, 2021), 이미지 초해상도(Li et al., 2022b), 이미지 인페인팅(Lugmayr et al., 2022)과 같은 생성 모델링 작업부터 이미지 분할(Amit et al., 2021), 분류(Zimmermann et al., 2021), 이상 감지(Wolleb et al., 2022a)와 같은 판별 작업에 이르기까지 다양한 영역에서 유용한 것으로 밝혀졌습니다.  
최근 의료 영상 커뮤니티는 확산 기반 기술의 수가 기하급수적으로 증가하는 것을 목격했습니다(그림 1 참조).  
그림 1에서 볼 수 있듯이 다양한 의료 영상 시나리오에서 확산 모델을 적용하기 위해 많은 연구가 진행되고 있습니다.  

![](https://ars.els-cdn.com/content/image/1-s2.0-S1361841523001068-gr1_lrg.jpg)

그림 1. 다이어그램 ( a)는 응용 분야와  
(b) 영상 모달리티에 따라 분류된 출판된 논문의 상대적 비율을 보여줍니다 .  
(c)는 의학 분야에서 출판된 확산 기반 연구 논문의 수를 나타냅니다.  
연간 성장률은 미래 작업을 위한 확산 모델의 중요성을 보여줍니다. 전체 논문 수가 103개라는 점을 언급할 가치가 있습니다.

확산 모델은 최근 연구 커뮤니티에서 상당한 관심을 받고 있기 때문에 이 방향으로 많은 기여를 하고 있습니다.  
따라서 기존 문헌에 대한 조사는 커뮤니티에 유익하고 시의적절합니다.  
이를 위해 이 설문조사는 최근 이루어진 발전에 대한 포괄적인 개요를 제공하고 의료 영상 분야에서 이러한 종류의 모델에 대한 전체적인 개요를 제공하기 위해 시작합니다.  
관련 문헌을 철저히 검색한 결과, 의료 영역에서 악용되는 확산 기반 모델을 최초로 다룬 것으로 밝혀졌습니다.  
이 연구가 새로운 경로를 지적하고 연구자에게 로드맵을 제공하며 비전 커뮤니티에 대한 관심을 불러일으켜 의료 영역에서 확산 모델의 잠재력을 활용할 수 있기를 바랍니다.  

주요 기여는 다음과 같습니다:  
∙ 이 논문은 의료 영상 영역에서 확산 모델의 적용을 포괄적으로 다루는 최초의 조사 논문입니다.  
특히, 2022년 10월까지 사용 가능한 모든 관련 논문에 대한 포괄적인 개요를 제시하고 2023년 4월까지 몇 가지 최신 기술을 소개합니다.
∙ 우리는 의료계에서 확산 모델과 그 응용에 대한 체계적인 분류를 제공하기 위해 확산 모델에 대한 다각적인 분류를 고안합니다.  
우리는 기존 확산 모델을 변형 기반 모델과 점수 기반 모델의 두 가지 범주로 나눕니다.  
또한 디퓨전 모델의 응용 프로그램을 이미지 간 변환, 재구성, 등록, 분류, 분할, 노이즈 제거, 이미지 생성, 이상 감지 및 기타 응용 프로그램의 9가지 범주로 그룹화합니다.
∙ 우리는 적용에 대한 관심을 제한하지 않고 각 논문이 각각 관련 기관 및 이미징 양식과 함께 제안된 알고리즘에 따라 광범위하게 분류되는 새로운 분류 체계(그림 5 참조)를 제공합니다.
∙ 마지막으로, 우리는 과제와 미해결 문제에 대해 논의하고 알고리즘과 애플리케이션 모두에서 의료 영역에서 확산 모델의 향후 개발에 대한 미해결 문제를 제기하는 새로운 트렌드를 식별합니다.

#### Motivation and uniqueness of this survey.
생성적 접근 방식은 지난 수십 년 동안 의료 영상 분야에서 상당한 발전을 이루었습니다.  
따라서 의료 영상에 대한 심층 생성 모델에 대한 수많은 설문조사 논문이 발표되었습니다(AlAmir and AlGhamdi, 2022; Ali et al., 2022a; Chen et al., 2022b).  
이러한 논문 중 일부는 특정 애플리케이션에만 초점을 맞추고 다른 논문은 특정 이미지 양식에 초점을 맞추고 있습니다.  
또한 최근 컴퓨터 비전 작업을 위해 등장한 확산 모델에 대한 리뷰 기사도 있습니다(Cao et al., 2022c; Yang et al., 2022; Croitoru et al., 2022).  
이 분야가 완전히 개발되기 전에 이미 리뷰가 발표되었지만 그 이후로 의료 분야에서 많은 발전이 이루어지고 있습니다.  
반면에 이러한 설문조사 중 이러한 연구 방향을 추진하는 데 있어 핵심적인 측면인 의료 영상 분야의 확산 모델 적용에 초점을 맞춘 조사는 없습니다.  
따라서 이러한 설문조사는 명확한 미해결 격차를 남깁니다.  
또한 의료계는 설문조사에서 제공된 확산 모델의 과거 및 미래 연구 방향을 회고함으로써 비전 분야의 성공적인 확산 모델 제품에서 얻은 인사이트를 활용할 수 있다고 믿습니다.  
또한 확산 모델은 합성 데이터를 생성하는 데 있어 잠재력을 입증했으며 기존 데이터를 효과적으로 보완할 뿐만 아니라 생물의학적 역영상 문제의 생성적 사전 역할을 할 수 있습니다(섹션 3에서 논의한 바와 같이).  
마지막으로, 우리는 설문조사가 의료 연구자(예: 방사선 전문의)에게 도움이 될 수 있으며 해당 분야의 최신 방법론을 활용하도록 안내할 수 있다고 생각합니다.  
이를 위해 본 설문조사에서는 의료 영역에서의 응용 사례를 기반으로 기존 문헌을 논의하는 확산 모델의 다각적인 비전을 고안합니다.  
그럼에도 불구하고 우리는 애플리케이션에 대한 관심을 제한하지 않고 제안된 방법의 근본적인 작동 원리, 기관 및 이미징 양식을 설명합니다.  
우리는 이 추가 정보가 연구자가 스펙트럼 전반에 걸쳐 문헌을 통합하는 데 어떻게 도움이 될 수 있는지 더 논의합니다.  
논문의 간략한 전망은 그림 5에 나와 있습니다.

